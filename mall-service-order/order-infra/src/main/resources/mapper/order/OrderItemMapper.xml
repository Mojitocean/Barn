<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.barn.order.infra.mapper.OrderItemMapper">

    <resultMap id="BaseResultMap" type="com.barn.order.domain.entity.OrderItem">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="sku_id" property="skuId" jdbcType="BIGINT"/>
        <result column="sku_name" property="skuName" jdbcType="VARCHAR"/>
        <result column="price" property="price" jdbcType="DECIMAL"/>
        <result column="count" property="count" jdbcType="INTEGER"/>
        <!-- orderId 通常不需要映射回 Domain Entity，因为它是聚合根的一部分，但在数据库层面它是外键 -->
    </resultMap>

    <!-- 插入单条 -->
    <insert id="insert">
        INSERT INTO oms_order_item (order_id, sku_id, sku_name, price, count)
        VALUES (#{orderId}, #{item.skuId}, #{item.skuName}, #{item.price}, #{item.count})
    </insert>

    <!-- 批量插入 (更高效) -->
    <insert id="insertBatch">
        INSERT INTO oms_order_item (order_id, sku_id, sku_name, price, count)
        VALUES
        <foreach collection="items" item="item" separator=",">
            (#{orderId}, #{item.skuId}, #{item.skuName}, #{item.price}, #{item.count})
        </foreach>
    </insert>

    <!-- 根据订单ID查询 -->
    <select id="selectByOrderId" resultMap="BaseResultMap">
        SELECT id, sku_id, sku_name, price, count
        FROM oms_order_item
        WHERE order_id = #{orderId}
    </select>

</mapper>